import sqlite3
from flask import Flask, jsonify, request

# Flask application to serve the CVE data
app = Flask(__name__)

@app.route('/api/cve/<cve_id>', methods=['GET'])
def get_cve_by_id(cve_id):
    conn = sqlite3.connect('cve_database.db')
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM cve_data WHERE cve_id=?", (cve_id,))
    row = cursor.fetchone()
    conn.close()
    if row:
        return jsonify({"cve_id": row[0], "description": row[1], "last_modified": row[2]})
    else:
        return jsonify({"error": "CVE not found"}), 404

@app.route('/api/cves/modified', methods=['GET'])
def get_cves_modified_within_days():
    days = int(request.args.get('days', 7))
    conn = sqlite3.connect('cve_database.db')
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM cve_data WHERE last_modified >= datetime('now','-{} days')".format(days))
    rows = cursor.fetchall()
    conn.close()
    return jsonify([{"cve_id": row[0], "description": row[1], "last_modified": row[2]} for row in rows])


if __name__ == '__main__':
    app.run(debug=True)